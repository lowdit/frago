{{- define "main" -}}
{{- $data      := newScratch -}}
{{- partialCached "utils/css.html" (dict "context" . "filefolder" "base" "filename" "layout" "inline" "true") "layout" -}}
{{- partialCached "utils/css.html" (dict "context" . "filefolder" "base" "filename" "main" "inline" "true") "main" -}}
{{- partialCached "utils/css.html" (dict "context" . "filefolder" "object" "filename" "card") "card" -}}

{{/* Use the audit last version */}}
{{- $referential := (partialCached "render/referential-version.html" (dict "context" . "referential" "opquast") . ).guideline -}}
{{- $.Store.Set "file" (index (index $.Site.Data $referential.name) $referential.version) -}}
{{- $criteriafile   := ($.Store.Get "file").criteria -}}

<article class="fg-wrapper narrow">
<style>
  ul, ol {
    padding-left: 1rem;
  }
  .titre, .important, .important + p {
    font-weight: bold;
  }
  .important, .important + * {
    color: var(--color-primary);
  }
  .background {
    background: #dedede;
  }
  .invert {
    padding: 0.25em 0.4em 0.25em;
    color: #fefefe;
    background: #333;
  }
  .svgblue {
    stroke: #00697a;
    fill: transparent;

  }
  .svgblue.empty {
    stroke: #b8d6da;
    fill: #b8d6da;
  }
  .svggreen {
    fill: #80a13d;
    stroke: #fff;
    stroke-width: 0;
  }
  .svggreen.empty {
    fill: transparent;
    stroke: #80a13d;
    stroke-width: 0.1px;
  }
</style>
<h1>{{ (index (index $.Site.Data $referential.name) $referential.version).criterias.title | safeHTML }}</h1>

{{- $data.Set "counterthematique" 0 }}
{{- $data.Set "thematique" slice }}
{{- $data.Set "subject" slice }}
{{- range $key1, $value1 := $criteriafile -}}
  {{ $data.Add "thematique" .topic }}
{{- end -}}
{{ $range60 := (slice "0" 3 7 15 16 17 22 26 29 57 58 59 61 62 67 69 74 77 78 85 88 90 98 99 105 112 113 116 119 120 131 132 135 143 144 151 160 161 163 166 168 177 189 190 192 193 194 198 207 212 213 216 217 219 220 222 223 227 232 233) }}
{{- range (where $criteriafile "number" "in" $range60) }}
  <h2>#{{ .number }} - {{ .description.fr | markdownify }}</h2>
  {{ with .goal }}<strong>Objectifs :</strong>
  <ul>
  {{- range .fr  -}}
   <li>{{ . }}</li>
  {{ end -}}
  </ul>
  {{ end -}}
  {{ with .explanation }}<strong>Descriptif :</strong> <p>{{ .fr | markdownify  }}</p>{{ end }}
  {{ with .solution }}<strong>Solution :</strong> {{ .fr | safeHTML }}{{ end }}
  {{ with .control }}<strong>Contrôle :</strong> {{ .fr | safeHTML }}{{ end }}
{{ end }}
{{/*- range $key, $value := uniq ($data.Get "thematique") }}
    {{- range $key1, $value1 := where $criteriafile "topic" . -}}
      <h2>{{ .id }} - {{ .criterium | markdownify }}</h2>
      <p>
        {{ with .goals }}<br><strong>Objectifs :</strong> {{ . | markdownify }}{{ end }}
        {{ with .implementation }}<br><strong>Mise en œuvre :</strong> {{ . | markdownify }}{{ end }}
        {{ with .control }}<br><strong>Contrôle :</strong> {{ . | markdownify }}{{ end }}
      </p>
    {{ end -}}
{{ end -*/}}

</article>
{{- end -}}
